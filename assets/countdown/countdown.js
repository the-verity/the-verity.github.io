/*global window module */
/**
 * @license countdown.js v2.6.1 http://countdownjs.org
 * Copyright (c)2006-2014 Stephen M. McKamey.
 * Licensed under The MIT License.
 */
/*jshint bitwise:false */

/**
 * API entry
 * @public
 * @param {function(Object)|Date|number} start the starting date
 * @param {function(Object)|Date|number} end the ending date
 * @param {number} units the units to populate
 * @return {Object|number}
 */
/*
 countdown.js v2.6.1 http://countdownjs.org
 Copyright (c)2006-2014 Stephen M. McKamey.
 Licensed under The MIT License.
*/
var countdown=function(){function d(a,b){var c=a.getTime();a.setMonth(a.getMonth()+b);return Math.round((a.getTime()-c)/864E5)}function g(a){var b=a.getTime(),c=new Date(b);c.setMonth(a.getMonth()+1);return Math.round((c.getTime()-b)/864E5)}function e(a,b){b=b instanceof Date||null!==b&&isFinite(b)?new Date(+b):new Date;if(!a)return b;var c=+a.value||0;if(c)return b.setTime(b.getTime()+c),b;(c=+a.milliseconds||0)&&b.setMilliseconds(b.getMilliseconds()+c);(c=+a.seconds||0)&&b.setSeconds(b.getSeconds()+
c);(c=+a.minutes||0)&&b.setMinutes(b.getMinutes()+c);(c=+a.hours||0)&&b.setHours(b.getHours()+c);(c=+a.weeks||0)&&(c*=7);(c+=+a.days||0)&&b.setDate(b.getDate()+c);(c=+a.months||0)&&b.setMonth(b.getMonth()+c);(c=+a.millennia||0)&&(c*=10);(c+=+a.centuries||0)&&(c*=10);(c+=+a.decades||0)&&(c*=10);(c+=+a.years||0)&&b.setFullYear(b.getFullYear()+c);return b}function k(a,b){return A(a)+(1===a?v[b]:w[b])}function r(){}function h(a,b,c,d,e,f){0<=a[c]&&(b+=a[c],delete a[c]);b/=e;if(1>=b+1)return 0;if(0<=a[d]){a[d]=
+(a[d]+b).toFixed(f);switch(d){case "seconds":if(60!==a.seconds||isNaN(a.minutes))break;a.minutes++;a.seconds=0;case "minutes":if(60!==a.minutes||isNaN(a.hours))break;a.hours++;a.minutes=0;case "hours":if(24!==a.hours||isNaN(a.days))break;a.days++;a.hours=0;case "days":if(7!==a.days||isNaN(a.weeks))break;a.weeks++;a.days=0;case "weeks":if(a.weeks!==g(a.refMonth)/7||isNaN(a.months))break;a.months++;a.weeks=0;case "months":if(12!==a.months||isNaN(a.years))break;a.years++;a.months=0;case "years":if(10!==
a.years||isNaN(a.decades))break;a.decades++;a.years=0;case "decades":if(10!==a.decades||isNaN(a.centuries))break;a.centuries++;a.decades=0;case "centuries":if(10!==a.centuries||isNaN(a.millennia))break;a.millennia++;a.centuries=0}return 0}return b}function t(a,b,c,q,e,f){var k=new Date;a.start=b=b||k;a.end=c=c||k;a.units=q;a.value=c.getTime()-b.getTime();0>a.value&&(k=c,c=b,b=k);if(0<a.value)return a.millennia=0,a.centuries=0,a.decades=0,a.years=0,a.months=0,a.weeks=0,a.days=0,a.hours=0,a.minutes=
0,a.seconds=0,a.milliseconds=0,a;a.refMonth=new Date(b.getFullYear(),b.getMonth(),15,12,0,0);try{a.millennia=0;a.centuries=0;a.decades=0;a.years=c.getFullYear()-b.getFullYear();a.months=c.getMonth()-b.getMonth();a.weeks=0;a.days=c.getDate()-b.getDate();a.hours=c.getHours()-b.getHours();a.minutes=c.getMinutes()-b.getMinutes();a.seconds=c.getSeconds()-b.getSeconds();a.milliseconds=c.getMilliseconds()-b.getMilliseconds();var p;0>a.milliseconds?(p=u(-a.milliseconds/1E3),a.seconds-=p,a.milliseconds+=1E3*
p):1E3<=a.milliseconds&&(a.seconds+=m(a.milliseconds/1E3),a.milliseconds%=1E3);0>a.seconds?(p=u(-a.seconds/60),a.minutes-=p,a.seconds+=60*p):60<=a.seconds&&(a.minutes+=m(a.seconds/60),a.seconds%=60);0>a.minutes?(p=u(-a.minutes/60),a.hours-=p,a.minutes+=60*p):60<=a.minutes&&(a.hours+=m(a.minutes/60),a.minutes%=60);0>a.hours?(p=u(-a.hours/24),a.days-=p,a.hours+=24*p):24<=a.hours&&(a.days+=m(a.hours/24),a.hours%=24);for(;0>a.days;)a.months--,a.days+=d(a.refMonth,1);7<=a.days&&(a.weeks+=m(a.days/7),a.days%=
7);0>a.months?(p=u(-a.months/12),a.years-=p,a.months+=12*p):12<=a.months&&(a.years+=m(a.months/12),a.months%=12);10<=a.years&&(a.decades+=m(a.years/10),a.years%=10,10<=a.decades&&(a.centuries+=m(a.decades/10),a.decades%=10,10<=a.centuries&&(a.millennia+=m(a.centuries/10),a.centuries%=10)));b=0;!(q&1024)||b>=e?(a.centuries+=10*a.millennia,delete a.millennia):a.millennia&&b++;!(q&512)||b>=e?(a.decades+=10*a.centuries,delete a.centuries):a.centuries&&b++;!(q&256)||b>=e?(a.years+=10*a.decades,delete a.decades):
a.decades&&b++;!(q&128)||b>=e?(a.months+=12*a.years,delete a.years):a.years&&b++;!(q&64)||b>=e?(a.months&&(a.days+=d(a.refMonth,a.months)),delete a.months,7<=a.days&&(a.weeks+=m(a.days/7),a.days%=7)):a.months&&b++;!(q&32)||b>=e?(a.days+=7*a.weeks,delete a.weeks):a.weeks&&b++;!(q&16)||b>=e?(a.hours+=24*a.days,delete a.days):a.days&&b++;!(q&8)||b>=e?(a.minutes+=60*a.hours,delete a.hours):a.hours&&b++;!(q&4)||b>=e?(a.seconds+=60*a.minutes,delete a.minutes):a.minutes&&b++;!(q&2)||b>=e?(a.milliseconds+=
1E3*a.seconds,delete a.seconds):a.seconds&&b++;if(!(q&1)||b>=e){var l=h(a,0,"milliseconds","seconds",1E3,f);if(l&&(l=h(a,l,"seconds","minutes",60,f))&&(l=h(a,l,"minutes","hours",60,f))&&(l=h(a,l,"hours","days",24,f))&&(l=h(a,l,"days","weeks",7,f))&&(l=h(a,l,"weeks","months",g(a.refMonth)/7,f))){q=l;var r,n=a.refMonth,t=n.getTime(),v=new Date(t);v.setFullYear(n.getFullYear()+1);r=Math.round((v.getTime()-t)/864E5);if(l=h(a,q,"months","years",r/g(a.refMonth),f))if(l=h(a,l,"years","decades",10,f))if(l=
h(a,l,"decades","centuries",10,f))if(l=h(a,l,"centuries","millennia",10,f))throw Error("Fractional unit overflow");}}}finally{delete a.refMonth}return a}function f(a,b,c,d,f){var g;c=+c||222;d=0<d?d:NaN;f=0<f?20>f?Math.round(f):20:0;var k=null;"function"===typeof a?(g=a,a=null):a instanceof Date||(null!==a&&isFinite(a)?a=new Date(+a):("object"===typeof k&&(k=a),a=null));var h=null;"function"===typeof b?(g=b,b=null):b instanceof Date||(null!==b&&isFinite(b)?b=new Date(+b):("object"===typeof b&&(h=
b),b=null));k&&(a=e(k,b));h&&(b=e(h,a));if(!a&&!b)return new r;if(!g)return t(new r,a,b,c,d,f);var k=c&1?1E3/30:c&2?1E3:c&4?6E4:c&8?36E5:c&16?864E5:6048E5,l,h=function(){g(t(new r,a,b,c,d,f),l)};h();return l=setInterval(h,k)}var u=Math.ceil,m=Math.floor,v,w,x,y,z,n,A,B;r.prototype.toString=function(a){var b=B(this),c=b.length;if(!c)return a?""+a:z;if(1===c)return b[0];a=x+b.pop();return b.join(y)+a};r.prototype.toHTML=function(a,b){a=a||"span";var c=B(this),d=c.length;if(!d)return(b=b||z)?"<"+a+">"+
b+"</"+a+">":b;for(var f=0;f<d;f++)c[f]="<"+a+">"+c[f]+"</"+a+">";if(1===d)return c[0];d=x+c.pop();return c.join(y)+d};r.prototype.addTo=function(a){return e(this,a)};B=function(a){var b=[],c=a.millennia;c&&b.push(n(c,10));(c=a.centuries)&&b.push(n(c,9));(c=a.decades)&&b.push(n(c,8));(c=a.years)&&b.push(n(c,7));(c=a.months)&&b.push(n(c,6));(c=a.weeks)&&b.push(n(c,5));(c=a.days)&&b.push(n(c,4));(c=a.hours)&&b.push(n(c,3));(c=a.minutes)&&b.push(n(c,2));(c=a.seconds)&&b.push(n(c,1));(c=a.milliseconds)&&
b.push(n(c,0));return b};f.MILLISECONDS=1;f.SECONDS=2;f.MINUTES=4;f.HOURS=8;f.DAYS=16;f.WEEKS=32;f.MONTHS=64;f.YEARS=128;f.DECADES=256;f.CENTURIES=512;f.MILLENNIA=1024;f.DEFAULTS=222;f.ALL=2047;var D=f.setFormat=function(a){if(a){if("singular"in a||"plural"in a){var b=a.singular||[];b.split&&(b=b.split("|"));var c=a.plural||[];c.split&&(c=c.split("|"));for(var d=0;10>=d;d++)v[d]=b[d]||v[d],w[d]=c[d]||w[d]}"string"===typeof a.last&&(x=a.last);"string"===typeof a.delim&&(y=a.delim);"string"===typeof a.empty&&
(z=a.empty);"function"===typeof a.formatNumber&&(A=a.formatNumber);"function"===typeof a.formatter&&(n=a.formatter)}},C=f.resetFormat=function(){v=" millisecond; second; minute; hour; day; week; month; year; decade; century; millennium".split(";");w=" milliseconds; seconds; minutes; hours; days; weeks; months; years; decades; centuries; millennia".split(";");x=" and ";y=", ";z="";A=function(a){return a};n=k};f.setLabels=function(a,b,c,d,f,e,g){D({singular:a,plural:b,last:c,delim:d,empty:f,formatNumber:e,
formatter:g})};f.resetLabels=C;C();"undefined"!==typeof module&&module.exports?module.exports=f:"undefined"!==typeof window&&"function"===typeof window.define&&"undefined"!==typeof window.define.amd&&window.define("countdown",[],function(){return f});return f}(),DIRECTIVE_KEY_MAP={Y:"years",m:"months",n:"daysToMonth",d:"daysToWeek",w:"weeks",W:"weeksToMonth",H:"hours",M:"minutes",S:"seconds",D:"days",I:"totalHours",N:"totalMinutes",T:"totalSeconds"};
function escapedRegExp(d){d=d.toString().replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");return new RegExp(d)}
function strftime(d){return function(g){var e=g.match(/%(-|!)?[A-Z]{1}(:[^;]+;)?/gi);if(e)for(var k=0,r=e.length;k<r;++k){var h=e[k].match(/%(-|!)?([a-zA-Z]{1})(:[^;]+;)?/),t=escapedRegExp(h[0]),f=h[1]||"",u=h[3]||"",m=null,h=h[2];DIRECTIVE_KEY_MAP.hasOwnProperty(h)&&(m=DIRECTIVE_KEY_MAP[h],m=Number(d[m]));null!==m&&("!"===f&&(m=pluralize(u,m)),""===f&&10>m&&(m="0"+m.toString()),g=g.replace(t,m.toString()))}return g=g.replace(/%%/,"%")}}
function pluralize(d,g){var e="s",k="";d&&(d=d.replace(/(:|;|\s)/gi,"").split(/\,/),1===d.length?e=d[0]:(k=d[0],e=d[1]));return 1<Math.abs(g)?e:k}var matchers=[];matchers.push(/^[0-9]*$/.source);matchers.push(/([0-9]{1,2}\/){2}[0-9]{4}( [0-9]{1,2}(:[0-9]{2}){2})?/.source);matchers.push(/[0-9]{4}([\/\-][0-9]{1,2}){2}( [0-9]{1,2}(:[0-9]{2}){2})?/.source);matchers=new RegExp(matchers.join("|"));
function parseDateString(d){if(d instanceof Date)return d;if(String(d).match(matchers)){if(String(d).match(/^[0-9]*$/)&&(d=Number(d)),String(d).match(/\-/)&&(d=String(d).replace(/\-/g,"/")),d=new Date(d),isValidDate(d))return d}else throw Error("Couldn't cast `"+d+"` to a date object.");}function isValidDate(d){return d instanceof Date&&!isNaN(d)}var isBuilder=document.querySelector("html").classList.contains("is-builder"),countdowns=[];
function initCountdown(d){document.querySelectorAll(".countdown:not(.countdown-inited)").forEach(function(g){var e=countdown.DAYS|countdown.HOURS|countdown.MINUTES|countdown.SECONDS;g.classList.add("countdown-inited");var k=parseDateString(g.getAttribute("data-due-date"));countdowns.find(function(e){return e.id===d.getAttribute("id")})&&(countdowns=[]);d.getAttribute("id")&&(e=countdown(k,function(d){d.strftime=strftime(d);var e=g.closest(".countdown-cont").querySelector("div.daysCountdown").getAttribute("title"),
k=g.closest(".countdown-cont").querySelector("div.hoursCountdown").getAttribute("title"),f=g.closest(".countdown-cont").querySelector("div.minutesCountdown").getAttribute("title"),u=g.closest(".countdown-cont").querySelector("div.secondsCountdown").getAttribute("title");g.innerHTML=d.strftime(['<div class="row"><div class="col-3"><div class="number-wrap"><span class="number display-2"><b>%D</b></span><span mbr-text class="period display-7">',e,'</span><span class="dot">:</span></div></div><div class="col-3"><div class="number-wrap"><span class="number display-2"><b>%H</b></span><span mbr-text class="period display-7">',
k,'</span><span class="dot">:</span></div></div><div class="col-3"><div class="number-wrap"><span class="number display-2"><b>%M</b></span><span mbr-text class="period display-7">',f,'</span><span class="dot">:</span></div></div><div class="col-3"><div class="number-wrap"><span class="number display-2"><b>%S</b></span><span mbr-text class="period display-7">',u,"</span></div></div></div>"].join(""))},e),e={id:d.getAttribute("id"),timerId:e},e.id&&countdowns.push(e))});document.querySelectorAll(".countdown:not(.countdown-inited)").forEach(function(d){new countdown(d.getAttribute("data-due-date"),
function(e){d.textContent=e.strftime("%D days %H:%M:%S")})})}
function initCountdownBuild(){document.querySelectorAll(".countdown:not(.countdown-inited)").forEach(function(d){var g=countdown.DAYS|countdown.HOURS|countdown.MINUTES|countdown.SECONDS;d.classList.add("countdown-inited");var e=parseDateString(d.getAttribute("data-due-date"));countdown(e,function(e){e.strftime=strftime(e);var g=d.closest(".countdown-cont").querySelector("div.daysCountdown").getAttribute("title"),h=d.closest(".countdown-cont").querySelector("div.hoursCountdown").getAttribute("title"),t=
d.closest(".countdown-cont").querySelector("div.minutesCountdown").getAttribute("title"),f=d.closest(".countdown-cont").querySelector("div.secondsCountdown").getAttribute("title");d.innerHTML=e.strftime(['<div class="row"><div class="col-3"><div class="number-wrap"><span class="number display-2"><b>%D</b></span><span mbr-text class="period display-7">',g,'</span><span class="dot">:</span></div></div><div class="col-3"><div class="number-wrap"><span class="number display-2"><b>%H</b></span><span mbr-text class="period display-7">',
h,'</span><span class="dot">:</span></div></div><div class="col-3"><div class="number-wrap"><span class="number display-2"><b>%M</b></span><span mbr-text class="period display-7">',t,'</span><span class="dot">:</span></div></div><div class="col-3"><div class="number-wrap"><span class="number display-2"><b>%S</b></span><span mbr-text class="period display-7">',f,"</span></div></div></div>"].join(""))},g)})}
function changeCountdown(d,g){var e=d.querySelector(".countdown");-1<g.search(/\d\d\d\d\/\d\d\/\d\d/g)&&(e.classList.remove("countdown-inited"),initCountdown(d))}
if(isBuilder)$(document).on("add.cards",function(d){0!=$(".countdown").length&&initCountdown(d.target)}).on("changeParameter.cards",function(d,g,e){if("countdown"===g){g=countdowns.find(function(e){return e.id===d.target.getAttribute("id")});var k=countdowns.findIndex(function(e){return e.id===d.target.getAttribute("id")});g&&(clearTimeout(g.timerId),countdowns.splice(k,1));changeCountdown(d.target,e)}}).on("delete.cards",function(d){if(d.target.querySelector(".countdown")){var g=countdowns.find(function(e){return e.id===
d.target.getAttribute("id")}),e=countdowns.findIndex(function(e){return e.id===d.target.getAttribute("id")});-1!==e&&(clearTimeout(g.timerId),countdowns.splice(e,1))}});else 0!=document.querySelectorAll(".countdown").length&&initCountdownBuild();
